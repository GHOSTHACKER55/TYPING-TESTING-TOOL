<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Anonymous Shadows - Typing Test</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1c1c1c, #2a2a2a);
            color: #fff;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        h1 {
            margin-top: 20px;
            color: #ff7b72;
            text-shadow: 1px 1px 3px #000;
            text-align: center;
        }
        #sentence {
            margin: 20px;
            font-size: 20px;
            line-height: 1.5;
            user-select: none; /* prevent copy */
            max-width: 90%;
            text-align: center;
        }
        #typingInput {
            width: 90%;
            padding: 10px;
            font-size: 18px;
            border-radius: 10px;
            border: none;
            outline: none;
            margin-bottom: 20px;
        }
        #results {
            margin: 10px;
            font-size: 18px;
        }
        button {
            padding: 12px 20px;
            font-size: 18px;
            border-radius: 10px;
            border: none;
            background: #ff7b72;
            color: white;
            cursor: pointer;
        }
        button:hover {
            background: #ff4b3e;
        }
    </style>
</head>
<body>
    <h1>Anonymous Shadows Typing Test</h1>
    <div id="sentence"></div>
    <input type="text" id="typingInput" placeholder="Start typing..." autocomplete="off">
    <div id="results"></div>

    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/10.6.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.6.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.6.0/firebase-messaging-compat.js"></script>

    <script>
        // Firebase config - replace with your actual keys
        const firebaseConfig = {
            apiKey: "AIzaSyCtjMyazrVnGFRASQOGjqeR_U9novXC15k",
            authDomain: "anonymous-shadows.firebaseapp.com",
            projectId: "anonymous-shadows",
            storageBucket: "anonymous-shadows.firebasestorage.app",
            messagingSenderId: "939891243370",
            appId: "1:939891243370:web:8db01f36d0afa9a58b8d13",
            vapidKey: "BPRhIQxTwlYR0K3pZD8QomSlZFBbZz4txXmbH-i0Q5oWaf54VTVjyZ4TqsfpBgac2IMOpeOY59DMb6lsoiMewSU"
        };

        // Initialize Firebase
        const app = firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const messaging = firebase.messaging();

        // Request notifications
        async function initFCM() {
            try {
                const permission = await Notification.requestPermission();
                if(permission === "granted") {
                    const token = await messaging.getToken({vapidKey: firebaseConfig.vapidKey});
                    console.log("FCM Token:", token);
                    await db.collection("notificationTokens").add({ token, timestamp: firebase.firestore.FieldValue.serverTimestamp() });
                }
            } catch(e) { console.error("FCM Error:", e); }
        }
        initFCM();

        // Typing sentences
        const sentences = [
            "The quick brown fox jumps over the lazy dog.",
            "How are you today? Hope everything is fine.",
            "Coding is fun when you learn step by step.",
            "Anonymous Shadows tracks your typing speed.",
            "Firebase powers notifications and real-time data."
        ];

        let currentSentence = "";
        let startTime;

        function newSentence() {
            const index = Math.floor(Math.random() * sentences.length);
            currentSentence = sentences[index];
            document.getElementById("sentence").innerText = currentSentence;
            document.getElementById("typingInput").value = "";
            startTime = new Date();
        }

        newSentence();

        document.getElementById("typingInput").addEventListener("input", function(e){
            const typed = e.target.value;
            if(typed === currentSentence) {
                const endTime = new Date();
                const timeDiff = (endTime - startTime)/1000;
                const wpm = Math.round((currentSentence.split(" ").length/timeDiff)*60);
                const accuracy = 100; // exact match

                document.getElementById("results").innerText = `Speed: ${wpm} WPM | Accuracy: ${accuracy}%`;

                // Save to Firestore
                db.collection("typingSessions").add({
                    sentence: currentSentence,
                    typed,
                    wpm,
                    accuracy,
                    timestamp: firebase.firestore.FieldValue.serverTimestamp()
                });

                newSentence();
            }
        });

        // Log user visit
        db.collection("userVisits").add({
            timestamp: firebase.firestore.FieldValue.serverTimestamp(),
            userAgent: navigator.userAgent,
            page: window.location.pathname
        });

        // Admin panel link (backend reads Firestore)
        const adminPanelURL = "https://admin-panel-mu-sable.vercel.app/";
    </script>
</body>
</html>