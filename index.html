<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ANONYMOUS SHADOWS</title>
<style>
  body {
    background: #0f172a;
    color: #fff;
    font-family: Arial, sans-serif;
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 20px;
  }
  h1 { color: #38bdf8; }
  .sentence-box, input, button {
    margin: 10px 0;
    font-size: 18px;
  }
  input {
    width: 100%;
    max-width: 600px;
    padding: 10px;
    border-radius: 6px;
    border: none;
  }
  button {
    padding: 10px 20px;
    border: none;
    border-radius: 6px;
    background: #2563eb;
    color: #fff;
    cursor: pointer;
    font-size: 16px;
  }
  .stats {
    margin-top: 20px;
  }
</style>
</head>
<body>

<h1>ANONYMOUS SHADOWS Typing Tool</h1>

<div class="sentence-box" id="sentenceBox">Loading sentence...</div>
<input type="text" id="typingInput" placeholder="Type the sentence here..." />
<button onclick="checkTyping()">Submit</button>

<div class="stats">
  <p>WPM: <span id="wpm">0</span></p>
  <p>Accuracy: <span id="accuracy">0</span>%</p>
</div>

<!-- Firebase SDKs -->
<script src="https://www.gstatic.com/firebasejs/10.6.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.6.0/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.6.0/firebase-messaging-compat.js"></script>

<script>
  // ðŸ”‘ Replace with your Firebase config from Gemini
  const firebaseConfig = {
    apiKey: "YOUR_API_KEY",
    authDomain: "anonymous-shadows.firebaseapp.com",
    projectId: "anonymous-shadows",
    storageBucket: "anonymous-shadows.appspot.com",
    messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
    appId: "YOUR_APP_ID",
    vapidKey: "YOUR_VAPID_KEY"
  };

  // Initialize Firebase
  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();
  const messaging = firebase.messaging();

  // Request Notification Permission
  Notification.requestPermission().then(permission => {
    if(permission === "granted"){
      messaging.getToken({vapidKey: firebaseConfig.vapidKey}).then(token => {
        console.log("FCM Token:", token);
        db.collection("tokens").add({ token: token, time: new Date() });
      }).catch(err => console.log("FCM Error:", err));
    }
  });

  // ----- Typing Tool Logic -----
  const sentences = [
    "How are you?",
    "How is your day going?",
    "Anonymous Shadows is a dark typing tool.",
    "Typing fast improves your WPM.",
    "Practice makes perfect in typing."
  ];

  let startTime;
  const sentenceBox = document.getElementById("sentenceBox");
  const inputBox = document.getElementById("typingInput");

  function newSentence() {
    const idx = Math.floor(Math.random() * sentences.length);
    sentenceBox.innerText = sentences[idx];
    inputBox.value = "";
    startTime = new Date();
  }

  function checkTyping() {
    const typed = inputBox.value;
    const target = sentenceBox.innerText;
    const endTime = new Date();
    const timeSec = (endTime - startTime) / 1000 / 60; // minutes
    const words = typed.split(" ").length;
    const wpm = Math.round(words / timeSec);

    // Accuracy calculation
    let correct = 0;
    for(let i=0; i<typed.length; i++){
      if(typed[i] === target[i]) correct++;
    }
    const accuracy = Math.round((correct / target.length) * 100);

    document.getElementById("wpm").innerText = wpm;
    document.getElementById("accuracy").innerText = accuracy;

    // Store result in Firestore
    db.collection("visits").add({
      sentence: target,
      typed: typed,
      wpm: wpm,
      accuracy: accuracy,
      time: new Date()
    });

    newSentence();
  }

  // Load first sentence
  newSentence();
</script>

</body>
</html>